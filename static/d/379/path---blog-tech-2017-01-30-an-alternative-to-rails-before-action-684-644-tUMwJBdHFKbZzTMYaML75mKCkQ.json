{"data":{"markdownRemark":{"html":"<p>To illustrate this I invented one task.</p>\n<p>There is a Ruby on Rails project. The task is to determine whether a page visitor has access to a controller method before the method execution. The ideal task for a controller filter, now called <code>before_action</code> in Rails. But I need the data from the filter in the controller method itself. I do not want to make a second request for the same data again. I do not want to clutter up the session and do not want to assign an instance variable in the controller filter.</p>\n<p>With the constraint above I produced the solution below:</p>\n<pre><code class=\"language-ruby\"># Models: User, CustomerSpecialOffer, SpecialOffer\n#\n# User has_many CustomerSpecialOffer as customer\n# CustomerSpecialOffer belongs_to customer\n# CustomerSpecialOffer belongs_to SpecialOffer\n# SpecialOffer has_many CustomerSpecialOffer\n#\nclass SpecialOfferController &#x3C; ApplicationController\n  def show\n    customer_special_offer_code do |offer_code|\n      special_offer = SpecialOffer.find(params[:id])\n      render 'show', locals: { special_offer: special_offer, offer_code: offer_code }\n    end\n  end\n  \n  def no_offers\n  end\n\n  private\n\n  def customer_special_offer_code\n    offer_code = CustomerSpecialOffer\n      .where(special_offer_id: params[:id], customer: current_user)\n      .select(:offer_code)\n      .first\n\n    if offer_code\n      yield(offer_code)\n    else\n      redirect_to 'no_offers'\n    end\n  end\nend\n</code></pre>","frontmatter":{"title":"An alternative to Rails `before_action`","description":"Rails `before_action` is a good tool but often used incorrectly. In this article, I will show what is wrong and my remedy for `before_action` abuse."}}},"pageContext":{"slug":"/blog/tech/2017-01-30-an-alternative-to-rails-before-action/","previous":null,"next":{"fields":{"slug":"/blog/tech/2019-04-07-hello-world/"},"frontmatter":{"title":"Hello world","description":null,"date":"2019-07-04T5:39:00Z+10"}}}}