{"data":{"markdownRemark":{"html":"<p><a href=\"https://github.com/rails/webpacker\">Webpacker</a> is an awesome tool and giant step towards front-end friendly development environment in Rails. But Webpacker requires installing Yarn. But what if want to use npm?</p>\n<p>This article will guide you how to replace Yarn with npm for Webpacker gem.</p>\n<h2>Preparation</h2>\n<p>If you starting a brand new Rails app include <code class=\"language-text\">--skip-yarn</code> option.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ rails new try_webpacker_with_npm_app --webpack --skip-yarn</code></pre></div>\n<p>Even with <code class=\"language-text\">--skip-yarn</code> flag enabled <code class=\"language-text\">rails new</code> command will try to install npm packages via Yarn. If you have Yarn installed then you need to execute the steps below to remove webpacker installation via Yarm. Otherwise, you will be warned with <code class=\"language-text\">Yarn not installedâ€¦</code> and no more actions are required.</p>\n<p>If you already started to use webpacker with Yarn you have to find and delete <code class=\"language-text\">yarn.lock</code> file and previously installed node modules.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">rm</span> yarn.lock\n$ <span class=\"token function\">rm</span> -rf node_modules</code></pre></div>\n<p>You can remove <code class=\"language-text\">bin/yarn</code> file as well.</p>\n<p><strong>Please note that you have to use webpacker 3.4.1 or greater and Ruby on Rails 5.1 and greater.</strong></p>\n<h2>Replacement</h2>\n<p>First, you need to disable Webpacker and Yarn integrity check. Add the line below to development and production environment configuration files.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">config<span class=\"token punctuation\">.</span>webpacker<span class=\"token punctuation\">.</span>check_yarn_integrity <span class=\"token operator\">=</span> <span class=\"token keyword\">false</span></code></pre></div>\n<p>The second step is to remove all rake tasks related to Yarn and define new npm tasks in Rakefile after <code class=\"language-text\">Rails.application.load_tasks</code> line.</p>\n<p>The last part. New npm tasks will be in <code class=\"language-text\">lib/tasks/webpacker.rake</code> file. <code class=\"language-text\">webpacker:check_npm</code> and <code class=\"language-text\">webpacker:npm_install</code> will be doing the same job as removed <code class=\"language-text\">webpacker:yarn_install</code> and <code class=\"language-text\">webpacker:check_yarn tasks</code>.</p>\n<p>The whole solution is listed below:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># config/environments/development.rb</span>\n\n<span class=\"token constant\">Rails</span><span class=\"token punctuation\">.</span>application<span class=\"token punctuation\">.</span>configure <span class=\"token keyword\">do</span>\n  config<span class=\"token punctuation\">.</span>webpacker<span class=\"token punctuation\">.</span>check_yarn_integrity <span class=\"token operator\">=</span> <span class=\"token keyword\">false</span>\n  \n  <span class=\"token comment\"># the rest of the file is omitted</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># config/environments/production.rb</span>\n\n<span class=\"token constant\">Rails</span><span class=\"token punctuation\">.</span>application<span class=\"token punctuation\">.</span>configure <span class=\"token keyword\">do</span>\n  config<span class=\"token punctuation\">.</span>webpacker<span class=\"token punctuation\">.</span>check_yarn_integrity <span class=\"token operator\">=</span> <span class=\"token keyword\">false</span>\n  \n  <span class=\"token comment\"># the rest of the file is omitted</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># Rakefile</span>\n\n<span class=\"token keyword\">require</span> <span class=\"token builtin\">File</span><span class=\"token punctuation\">.</span>expand_path<span class=\"token punctuation\">(</span><span class=\"token string\">'../config/application'</span><span class=\"token punctuation\">,</span> __FILE__<span class=\"token punctuation\">)</span>\n\n<span class=\"token constant\">Rails</span><span class=\"token punctuation\">.</span>application<span class=\"token punctuation\">.</span>load_tasks\n\n<span class=\"token comment\"># Replace yarn with npm</span>\n<span class=\"token constant\">Rake</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Task</span><span class=\"token punctuation\">[</span><span class=\"token string\">'yarn:install'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>clear <span class=\"token keyword\">if</span> <span class=\"token constant\">Rake</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Task</span><span class=\"token punctuation\">.</span>task_defined<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span><span class=\"token string\">'yarn:install'</span><span class=\"token punctuation\">)</span>\n<span class=\"token constant\">Rake</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Task</span><span class=\"token punctuation\">[</span><span class=\"token string\">'webpacker:yarn_install'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>clear\n<span class=\"token constant\">Rake</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Task</span><span class=\"token punctuation\">[</span><span class=\"token string\">'webpacker:check_yarn'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>clear\n<span class=\"token constant\">Rake</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Task</span><span class=\"token punctuation\">.</span>define_task<span class=\"token punctuation\">(</span><span class=\"token string\">'webpacker:verify_install'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token string\">'webpacker:check_npm'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token constant\">Rake</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Task</span><span class=\"token punctuation\">.</span>define_task<span class=\"token punctuation\">(</span><span class=\"token string\">'webpacker:compile'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token string\">'webpacker:npm_install'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># lib/tasks/webpacker.rake</span>\n\nnamespace <span class=\"token symbol\">:webpacker</span> <span class=\"token keyword\">do</span>\n  task <span class=\"token symbol\">:check_npm</span> <span class=\"token keyword\">do</span>\n    <span class=\"token keyword\">begin</span>\n      npm_version <span class=\"token operator\">=</span> `npm <span class=\"token operator\">--</span>version`\n      <span class=\"token keyword\">raise</span> <span class=\"token constant\">Errno</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">ENOENT</span> <span class=\"token keyword\">if</span> npm_version<span class=\"token punctuation\">.</span>blank<span class=\"token operator\">?</span>\n      version <span class=\"token operator\">=</span> <span class=\"token constant\">Gem</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Version</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>npm_version<span class=\"token punctuation\">)</span>\n\n      package_json_path <span class=\"token operator\">=</span> <span class=\"token constant\">Pathname</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"<span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span><span class=\"token constant\">Rails</span><span class=\"token punctuation\">.</span>root<span class=\"token delimiter tag\">}</span></span>/package.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>realpath\n      npm_requirement <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">(</span>package_json_path<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>dig<span class=\"token punctuation\">(</span><span class=\"token string\">'engines'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'npm'</span><span class=\"token punctuation\">)</span>\n      requirement <span class=\"token operator\">=</span> <span class=\"token constant\">Gem</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Requirement</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>npm_requirement<span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">unless</span> requirement<span class=\"token punctuation\">.</span>satisfied_by<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>version<span class=\"token punctuation\">)</span>\n        <span class=\"token variable\">$stderr</span><span class=\"token punctuation\">.</span>puts <span class=\"token string\">\"Webpacker requires npm <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>requirement<span class=\"token delimiter tag\">}</span></span> and you are using <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>version<span class=\"token delimiter tag\">}</span></span>\"</span> <span class=\"token operator\">&amp;&amp;</span> exit<span class=\"token operator\">!</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">rescue</span> <span class=\"token constant\">Errno</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">ENOENT</span>\n      <span class=\"token variable\">$stderr</span><span class=\"token punctuation\">.</span>puts <span class=\"token string\">'npm not installed'</span>\n      <span class=\"token variable\">$stderr</span><span class=\"token punctuation\">.</span>puts <span class=\"token string\">'Install NPM https://www.npmjs.com/get-npm'</span> <span class=\"token operator\">&amp;&amp;</span> exit<span class=\"token operator\">!</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n\n  task <span class=\"token symbol\">:npm_install</span> <span class=\"token keyword\">do</span>\n    system <span class=\"token string\">'npm install'</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<hr>\n<p>Please share this article if you like it. I would love to hear your opinion and how the solution works for you.</p>","frontmatter":{"title":"An alternative to Rails `before_action`","description":"This article will guide you how to replace Yarn with npm for Webpacker gem.","related":null}}},"pageContext":{"slug":"/blog/tech/2018-03-27-how-to-use-webpacker-with-npm-instead-of-yarn-rails-guide/","previous":null,"next":{"fields":{"slug":"/blog/tech/2017-01-30-an-alternative-to-rails-before-action/"},"frontmatter":{"title":"An alternative to Rails `before_action`","description":"Rails `before_action` is a good tool but often used incorrectly. In this article, I will show what is wrong and my remedy for `before_action` abuse.","date":"2017-01-30T00:00:00.000Z"}}}}