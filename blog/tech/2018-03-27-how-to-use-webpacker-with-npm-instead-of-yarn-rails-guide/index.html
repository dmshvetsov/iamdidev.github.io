<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/app.2f2933dc343b474e635f.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><style data-href="/component---src-templates-blog-post-jsx.0828aaf984a3bc83c03b.css">*{box-sizing:border-box;margin:0;padding:0}body,html{color:#2b2d42;font-size:18px;font-family:helvetica,sans-serif;line-height:1.4rem;font-weight:400}p{margin-bottom:1rem}body{padding:1.4rem .7rem;background-color:#f9fbfb}a{position:relative;color:#2b2d42;text-decoration:none;border-bottom:3px solid #d90429}a:before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background-color:#ef233c;transition:opacity .2s;opacity:0;z-index:-1}a:hover:before{opacity:.5}a:active:before{opacity:.7}.sdm-multiline-link{transition:background-color .2s}.sdm-multiline-link:before{content:none}.sdm-multiline-link:hover{background-color:rgba(239,35,60,.5)}.sdm-multiline-link:active{background-color:rgba(239,35,60,.7)}h1,h2{font-weight:900}h1{font-size:1.8rem;line-height:1.9rem;margin-bottom:2rem}h2{font-size:1.4rem;line-height:1.5rem;margin-top:1.4rem;margin-bottom:1rem}.sdm-accent{color:#ef233c}ol,ul{list-style:none;margin-bottom:1rem}.sdm-nav,footer{font-size:.75rem}.sdm-nav{margin-bottom:1rem}.sdm-nav:before{content:"\2190";margin-right:.2rem}@media screen and (min-width:701px){body{padding:1.4rem}}@media screen and (min-width:1025px){body,html{font-size:1.8vw}}.sdm-layout__block{margin-bottom:1.5rem}.sdm-blog__description{font-weight:400}.sdm-blog__content{font-size:1rem}.sdm-blog__content a{border:none;text-decoration:underline;color:#d90429}.sdm-blog__content a:hover{opacity:.8}.sdm-blog__content a:before{background-color:transparent}.sdm-blog__content p{margin-bottom:1rem}.sdm-blog__content ol,.sdm-blog__content ul{margin-left:1rem;margin-bottom:1rem}.sdm-blog__content ol{list-style-type:decimal}.sdm-blog__content ul{list-style:square}.sdm-blog__content hr{border:none;text-align:center;padding:1rem 0}.sdm-blog__content hr:after{content:". . .";display:inline-block;position:relative;top:-.75rem;font-size:1.5rem;background:transparent}.sdm-blog__content blockquote{font-style:italic;border-left:.2rem solid #ef233c;padding-left:1rem}.sdm-blog__content pre{width:100vw;font-size:.8rem;margin-left:-.7rem;margin-right:-.7rem;padding:.7rem;margin-bottom:1rem}@media screen and (min-width:768px){.sdm-blog__content{font-size:1rem;width:750px}.sdm-blog__content pre{margin-left:-1.4rem;margin-right:-1.4rem;padding:.7rem 1.4rem}}</style><meta name="generator" content="Gatsby 2.0.53"/><title data-react-helmet="true">Dmitry Shvetsov, Fullstack Developer</title><meta data-react-helmet="true" name="description" content="Full stack web developer. I use with love Ruby, Node.js, JavaScript, SQL, NoSQL databases. Based in Vladivostok, Russia."/><meta data-react-helmet="true" name="author" content="Dmitry Shvetsov"/><meta data-react-helmet="true" name="og:title" content="Dmitry Shvetsov, Fullstack Developer"/><meta data-react-helmet="true" name="og:url" content="https://shvetsovdm.github.io/"/><meta data-react-helmet="true" name="og:description" content="Full stack web developer. I use with love Ruby, Node.js, JavaScript, SQL, NoSQL databases. Based in Vladivostok, Russia."/><meta data-react-helmet="true" name="og:image" content="https://www.gravatar.com/avatar/b8c8cd15abf09e505baec08c61a054a7"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#ef233c"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/0-db19d7fcec3bd86415fa.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-jsx-4685366c953814782e7a.js"/><link as="script" rel="preload" href="/app-7adc6da1223f4911c098.js"/><link as="script" rel="preload" href="/webpack-runtime-180a480bf709e5d704e2.js"/><link rel="preload" href="/static/d/958/path---blog-tech-2018-03-27-how-to-use-webpacker-with-npm-instead-of-yarn-rails-guide-a-03-e23-3lU4O8ZqO1kNyZhNwSpvmAMGho.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><nav class="sdm-nav"><a href="/blog">All articles</a></nav><div class="sdm-layout"><article class="sdm-layout__block"><h1>How to use Webpacker with npm instead of Yarn, Rails guide</h1><h2 class="sdm-blog__description">This article will guide you how to replace Yarn with npm for Webpacker gem.</h2><div class="sdm-blog__content"><p><a href="https://github.com/rails/webpacker">Webpacker</a> is an awesome tool and giant step towards front-end friendly development environment in Rails. But Webpacker requires installing Yarn. But what if want to use npm?</p>
<p>This article will guide you how to replace Yarn with npm for Webpacker gem.</p>
<h2>Preparation</h2>
<p>If you starting a brand new Rails app include <code class="language-text">--skip-yarn</code> option.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ rails new try_webpacker_with_npm_app --webpack --skip-yarn</code></pre></div>
<p>Even with <code class="language-text">--skip-yarn</code> flag enabled <code class="language-text">rails new</code> command will try to install npm packages via Yarn. If you have Yarn installed then you need to execute the steps below to remove webpacker installation via Yarm. Otherwise, you will be warned with <code class="language-text">Yarn not installed…</code> and no more actions are required.</p>
<p>If you already started to use webpacker with Yarn you have to find and delete <code class="language-text">yarn.lock</code> file and previously installed node modules.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">rm</span> yarn.lock
$ <span class="token function">rm</span> -rf node_modules</code></pre></div>
<p>You can remove <code class="language-text">bin/yarn</code> file as well.</p>
<p><strong>Please note that you have to use webpacker 3.4.1 or greater and Ruby on Rails 5.1 and greater.</strong></p>
<h2>Replacement</h2>
<p>First, you need to disable Webpacker and Yarn integrity check. Add the line below to development and production environment configuration files.</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby">config<span class="token punctuation">.</span>webpacker<span class="token punctuation">.</span>check_yarn_integrity <span class="token operator">=</span> <span class="token keyword">false</span></code></pre></div>
<p>The second step is to remove all rake tasks related to Yarn and define new npm tasks in Rakefile after <code class="language-text">Rails.application.load_tasks</code> line.</p>
<p>The last part. New npm tasks will be in <code class="language-text">lib/tasks/webpacker.rake</code> file. <code class="language-text">webpacker:check_npm</code> and <code class="language-text">webpacker:npm_install</code> will be doing the same job as removed <code class="language-text">webpacker:yarn_install</code> and <code class="language-text">webpacker:check_yarn tasks</code>.</p>
<p>The whole solution is listed below:</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># config/environments/development.rb</span>

<span class="token constant">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>configure <span class="token keyword">do</span>
  config<span class="token punctuation">.</span>webpacker<span class="token punctuation">.</span>check_yarn_integrity <span class="token operator">=</span> <span class="token keyword">false</span>
  
  <span class="token comment"># the rest of the file is omitted</span></code></pre></div>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># config/environments/production.rb</span>

<span class="token constant">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>configure <span class="token keyword">do</span>
  config<span class="token punctuation">.</span>webpacker<span class="token punctuation">.</span>check_yarn_integrity <span class="token operator">=</span> <span class="token keyword">false</span>
  
  <span class="token comment"># the rest of the file is omitted</span></code></pre></div>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># Rakefile</span>

<span class="token keyword">require</span> <span class="token builtin">File</span><span class="token punctuation">.</span>expand_path<span class="token punctuation">(</span><span class="token string">'../config/application'</span><span class="token punctuation">,</span> __FILE__<span class="token punctuation">)</span>

<span class="token constant">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>load_tasks

<span class="token comment"># Replace yarn with npm</span>
<span class="token constant">Rake</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Task</span><span class="token punctuation">[</span><span class="token string">'yarn:install'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clear <span class="token keyword">if</span> <span class="token constant">Rake</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Task</span><span class="token punctuation">.</span>task_defined<span class="token operator">?</span><span class="token punctuation">(</span><span class="token string">'yarn:install'</span><span class="token punctuation">)</span>
<span class="token constant">Rake</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Task</span><span class="token punctuation">[</span><span class="token string">'webpacker:yarn_install'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clear
<span class="token constant">Rake</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Task</span><span class="token punctuation">[</span><span class="token string">'webpacker:check_yarn'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clear
<span class="token constant">Rake</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Task</span><span class="token punctuation">.</span>define_task<span class="token punctuation">(</span><span class="token string">'webpacker:verify_install'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'webpacker:check_npm'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token constant">Rake</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Task</span><span class="token punctuation">.</span>define_task<span class="token punctuation">(</span><span class="token string">'webpacker:compile'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'webpacker:npm_install'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># lib/tasks/webpacker.rake</span>

namespace <span class="token symbol">:webpacker</span> <span class="token keyword">do</span>
  task <span class="token symbol">:check_npm</span> <span class="token keyword">do</span>
    <span class="token keyword">begin</span>
      npm_version <span class="token operator">=</span> `npm <span class="token operator">--</span>version`
      <span class="token keyword">raise</span> <span class="token constant">Errno</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ENOENT</span> <span class="token keyword">if</span> npm_version<span class="token punctuation">.</span>blank<span class="token operator">?</span>
      version <span class="token operator">=</span> <span class="token constant">Gem</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Version</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>npm_version<span class="token punctuation">)</span>

      package_json_path <span class="token operator">=</span> <span class="token constant">Pathname</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">"<span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token constant">Rails</span><span class="token punctuation">.</span>root<span class="token delimiter tag">}</span></span>/package.json"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>realpath
      npm_requirement <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>package_json_path<span class="token punctuation">.</span>read<span class="token punctuation">)</span><span class="token punctuation">.</span>dig<span class="token punctuation">(</span><span class="token string">'engines'</span><span class="token punctuation">,</span> <span class="token string">'npm'</span><span class="token punctuation">)</span>
      requirement <span class="token operator">=</span> <span class="token constant">Gem</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Requirement</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>npm_requirement<span class="token punctuation">)</span>

      <span class="token keyword">unless</span> requirement<span class="token punctuation">.</span>satisfied_by<span class="token operator">?</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span>
        <span class="token variable">$stderr</span><span class="token punctuation">.</span>puts <span class="token string">"Webpacker requires npm <span class="token interpolation"><span class="token delimiter tag">#{</span>requirement<span class="token delimiter tag">}</span></span> and you are using <span class="token interpolation"><span class="token delimiter tag">#{</span>version<span class="token delimiter tag">}</span></span>"</span> <span class="token operator">&amp;&amp;</span> exit<span class="token operator">!</span>
      <span class="token keyword">end</span>
    <span class="token keyword">rescue</span> <span class="token constant">Errno</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ENOENT</span>
      <span class="token variable">$stderr</span><span class="token punctuation">.</span>puts <span class="token string">'npm not installed'</span>
      <span class="token variable">$stderr</span><span class="token punctuation">.</span>puts <span class="token string">'Install NPM https://www.npmjs.com/get-npm'</span> <span class="token operator">&amp;&amp;</span> exit<span class="token operator">!</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  task <span class="token symbol">:npm_install</span> <span class="token keyword">do</span>
    system <span class="token string">'npm install'</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div></div></article><footer class="sdm-layout__block sdm-layout__block--footer"><p>© Dmitry Shvetsov, 2016-2019</p></footer></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-47078794-2', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-jsx","jsonName":"blog-tech-2018-03-27-how-to-use-webpacker-with-npm-instead-of-yarn-rails-guide-a03","path":"/blog/tech/2018-03-27-how-to-use-webpacker-with-npm-instead-of-yarn-rails-guide/"};window.dataPath="958/path---blog-tech-2018-03-27-how-to-use-webpacker-with-npm-instead-of-yarn-rails-guide-a-03-e23-3lU4O8ZqO1kNyZhNwSpvmAMGho";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.2f2933dc343b474e635f.css","/app-7adc6da1223f4911c098.js"],"component---src-templates-blog-post-jsx":["/component---src-templates-blog-post-jsx.0828aaf984a3bc83c03b.css","/component---src-templates-blog-post-jsx-4685366c953814782e7a.js"],"component---src-pages-404-js":["/component---src-pages-404-js.6067bc39943a4c5d3771.css","/component---src-pages-404-js-3b3f9a77386270d1d123.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js.6067bc39943a4c5d3771.css","/component---src-pages-blog-js-12a9edc987792c381e05.js"],"component---src-pages-index-js":["/component---src-pages-index-js.422f8ebedcb6b35dcf32.css","/component---src-pages-index-js-98b6096360c72207371d.js"],"component---src-pages-travels-2019-03-beijing-js":["/component---src-pages-travels-2019-03-beijing-js.6067bc39943a4c5d3771.css","/component---src-pages-travels-2019-03-beijing-js-25b68bf7e2fecd80b05f.js"]};/*]]>*/</script><script src="/webpack-runtime-180a480bf709e5d704e2.js" async=""></script><script src="/app-7adc6da1223f4911c098.js" async=""></script><script src="/component---src-templates-blog-post-jsx-4685366c953814782e7a.js" async=""></script><script src="/0-db19d7fcec3bd86415fa.js" async=""></script></body></html>